"use strict";(self.webpackChunkubc_services=self.webpackChunkubc_services||[]).push([[1518],{9930:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_001-1e59ef36f7e0e211b9d4933abfd2321e.png"},12117:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"MQTT/documentation","title":"MQTT Integration (UBC.mqtt)","description":"UBC - Unified Backend Connector includes a component for acting as an MQTT client (over WebSocket), available from version 750 onwards. It enables real-time, fail-safe messaging without requiring middleware management or handling topics related to system availability, buffering, or firewalls.","source":"@site/docs/products/UBC/MQTT/documentation.md","sourceDirName":"MQTT","slug":"/MQTT/documentation","permalink":"/products/UBC/MQTT/documentation","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"ubc","previous":{"title":"JSON integration (UBC.json)","permalink":"/products/UBC/JSON/documentation"},"next":{"title":"MES Integration","permalink":"/products/UBC/integrations/MES/documentation"}}');var t=i(74848),r=i(28453);const o={},l="MQTT Integration (UBC.mqtt)",a={},c=[{value:"Key Advantages of Using UBC.mqtt",id:"key-advantages-of-using-ubcmqtt",level:2},{value:"Overview from an <strong>SAP Perspective</strong>",id:"overview-from-an-sap-perspective",level:3},{value:"MQTT Client",id:"mqtt-client",level:2},{value:"Recommendation",id:"recommendation",level:3},{value:"Handler",id:"handler",level:2},{value:"Handler Implementation",id:"handler-implementation",level:3},{value:"Simple Implementation",id:"simple-implementation",level:2},{value:"Setup",id:"setup",level:3},{value:"Handler Implementation (Inbound)",id:"handler-implementation-inbound",level:3},{value:"Publish Message (Outbound)",id:"publish-message-outbound",level:3},{value:"Custom Implementation",id:"custom-implementation",level:2}];function d(e){const n={a:"a",admonition:"admonition",br:"br",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"mqtt-integration-ubcmqtt",children:"MQTT Integration (UBC.mqtt)"})}),"\n",(0,t.jsxs)(n.p,{children:["UBC - Unified Backend Connector includes a component for acting as an ",(0,t.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/MQTT",children:"MQTT"})," client (over WebSocket), available from version 750 onwards. It enables real-time, fail-safe messaging without requiring middleware management or handling topics related to system availability, buffering, or firewalls."]}),"\n",(0,t.jsxs)(n.p,{children:["Unlike SAP's standard implementation, UBC.mqtt supports ",(0,t.jsx)(n.a,{href:"https://www.hivemq.com/blog/mqtt-essentials-part-7-persistent-session-queuing-messages/",children:"persistent sessions"}),", unlocking entirely new capabilities for your SAP system without the need for middleware technology."]}),"\n",(0,t.jsx)(n.p,{children:"This document describes the technology and how to integrate a new use case."}),"\n",(0,t.jsx)(n.h2,{id:"key-advantages-of-using-ubcmqtt",children:"Key Advantages of Using UBC.mqtt"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:['No firewall issues\u2014connection is established "from" the SAP system via MQTT ',(0,t.jsx)(n.strong,{children:"over WebSocket"}),' "inside out."']}),"\n",(0,t.jsx)(n.li,{children:'"Clean session" configuration enables persistent sessions, allowing the MQTT broker to store messages when disconnected.'}),"\n",(0,t.jsx)(n.li,{children:"Available from version 750 onwards."}),"\n",(0,t.jsx)(n.li,{children:"The only required component is an MQTT broker, which distributes messages to clients."}),"\n"]}),"\n",(0,t.jsxs)(n.h3,{id:"overview-from-an-sap-perspective",children:["Overview from an ",(0,t.jsx)(n.strong,{children:"SAP Perspective"})]}),"\n",(0,t.jsx)(n.mermaid,{value:"sequenceDiagram\nautonumber\nparticipant SAP as SAP MQTT Client\nparticipant Client as Other MQTT Client\nparticipant Broker as MQTT Broker\n\nSAP ->> Broker: Initiate (CONNECT over WebSocket)\nSAP ->> Broker: Subscribe to relevant topics (persistent session)\nClient ->> Broker: Initiate (CONNECT)\nClient ->> Broker: Send message to a topic (PUBLISH)\nBroker ->> SAP: Forward message (subscribed topic)\nalt QoS > at most once\n    SAP ->> Broker: Confirm message receipt\nend\nSAP ->> SAP: Start asynchronous processing using bgRFC"}),"\n",(0,t.jsx)(n.h2,{id:"mqtt-client",children:"MQTT Client"}),"\n",(0,t.jsx)(n.p,{children:"There are two main ways to set up UBC as an MQTT client. Regardless of the method, both unlock all MQTT capabilities for direct SAP connection:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Running the client in a periodically scheduled job:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"If the job runs every minute, the SAP-UBC client connects to the broker, waits for messages for a predefined duration, and then disconnects."}),"\n",(0,t.jsx)(n.li,{children:'A "clean session" is not suitable for this scenario; it must always be persistent (QoS >= 1).'}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Template:"})," ",(0,t.jsx)(n.code,{children:"/UBC/S17_MQTT_WS_CLIENT"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Running the client as an ABAP Daemon:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"An MQTT daemon runs continuously per client, keeping the WebSocket connection to the broker active."}),"\n",(0,t.jsx)(n.li,{children:"New messages are pushed immediately to the SAP system/MQTT client."}),"\n",(0,t.jsxs)(n.li,{children:["The daemon, a subclass of ",(0,t.jsx)(n.code,{children:"/UBC/CL_MQTT_DAEMON_ABS"}),", is scheduled independently."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Availability:"})," Daemons are supported in S/4HANA but not in ECC (use the job method instead)."]}),"\n",(0,t.jsx)(n.li,{children:"If a persistent session (QoS >= 1) is configured, messages will be received after reconnection."}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Example:"})," ",(0,t.jsx)(n.code,{children:"/UBC/CL_S17_MQTT_DAEMON"})," for the S1Seven use case."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"recommendation",children:"Recommendation"}),"\n",(0,t.jsxs)(n.p,{children:['Use daemons if available. However, since daemons cannot guarantee 24/7 availability (due to downtimes, etc.), configuring a "persistent session" is recommended. Typically, only one daemon per system is needed (not per client/application server), controlled by the server group (',(0,t.jsx)(n.code,{children:"RZ12"}),")."]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["For acting as a client (subscription/pull), handlers can be linked to topics. For publishing messages, only daemons provide out-of-the-box functionality: ",(0,t.jsx)(n.code,{children:"/UBC/IF_MQTT_CONTROL_CLNT_ASY~PUBLISH"}),"."]})}),"\n",(0,t.jsx)(n.h2,{id:"handler",children:"Handler"}),"\n",(0,t.jsxs)(n.p,{children:['Each "proxy" (endpoint) automatically registers for all topics specified in ',(0,t.jsx)(n.code,{children:"/UBC/CUSTOMIZING"})," under the ",(0,t.jsx)(n.strong,{children:"MQTT handler configuration"})," section for its proxy type:"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"MQTT handler configuration",src:i(9930).A+"",width:"1251",height:"241"})}),"\n",(0,t.jsxs)(n.p,{children:["A topic is linked to its ",(0,t.jsx)(n.a,{href:"#handler",children:"implementation"}),", and the ",(0,t.jsx)(n.a,{href:"https://www.hivemq.com/blog/mqtt-essentials-part-6-mqtt-quality-of-service-levels/",children:"QoS (Quality of Service)"}),' is specified. Using "at least once" ensures message delivery in SAP (persistent session).']}),"\n",(0,t.jsxs)(n.p,{children:["Once a message is received, it is transmitted to the bgRFC destination ",(0,t.jsx)(n.code,{children:"/UBC/INBOUND"})," (automatically created during system setup for UBC; see transaction ",(0,t.jsx)(n.code,{children:"SBGRFCCONF"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:["This mechanism utilizes parallel processing based on scheduler and server group configurations. The bgRFC executes the handler class specified earlier. Depending on the QoS setting, messages are acknowledged after transmission to the bgRFC runtime. For technical errors, refer to SAP monitoring transaction ",(0,t.jsx)(n.code,{children:"SBGRFCMON"}),"."]}),"\n",(0,t.jsx)(n.h3,{id:"handler-implementation",children:"Handler Implementation"}),"\n",(0,t.jsx)(n.p,{children:"Generic superclass options for handler implementation:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/UBC/CL_MQTT_HDL_REC_JSON_ABS"})," \u2013 For JSON payloads (default format: lowercase). Override ",(0,t.jsx)(n.code,{children:"DESERIALIZE_MESSAGE"})," if a different format is needed."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/UBC/CL_MQTT_HDL_REC_STRING_A"})," \u2013 For STRING payloads."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"/UBC/CL_MQTT_HDL_REC_ABS"})," \u2013 For other formats (requires implementing ",(0,t.jsx)(n.code,{children:"DESERIALIZE_MESSAGE"})," in ABAP)."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example for STRING:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-abap",children:'class zubc_cl_mqtt_msg_string definition\n  public\n  create public\n  inheriting from /ubc/cl_mqtt_hdl_rec_string_a.\n\n  public section.\n  protected section.\n    methods on_message redefinition.\n  private section.\nendclass.\n\nclass zubc_cl_mqtt_msg_string implementation.\n  method on_message.\n    data(lr_message) = ref string( iv_message ).\n\n    "TODO: Process string\n  endmethod.\nendclass.\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The class ",(0,t.jsx)(n.code,{children:"ZUBC_CL_MQTT_MSG_STRING"})," is specified in customizing for a topic."]}),"\n",(0,t.jsx)(n.h2,{id:"simple-implementation",children:"Simple Implementation"}),"\n",(0,t.jsx)(n.p,{children:"UBC provides an out-of-the-box implementation for basic use cases where the endpoint only connects to an MQTT broker."}),"\n",(0,t.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,t.jsxs)(n.p,{children:["Run transaction ",(0,t.jsx)(n.code,{children:"/UBC/MQTT_SMPL_SETUP"}),". This must be configured on each system, as it is not transportable."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Configure Proxy"}),(0,t.jsx)(n.br,{}),"\n",(0,t.jsx)(n.img,{alt:"Configure Proxy details",src:i(58913).A+"",width:"1276",height:"322"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Organization ID:"})," Unique identifier for the use case."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MQTT over WebSocket endpoint:"})," Fully qualified domain name (FQDN) pointing to the broker."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Username and password:"})," Stored securely and used for authentication."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"MQTT Daemon Setup (Daemon or Job)"})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsx)(n.p,{children:"Daemons are recommended."})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"RFC Destination:"})," Used for daemon login. See ",(0,t.jsx)(n.a,{href:"https://help.sap.com/docs/ABAP_PLATFORM_NEW/753088fc00704d0a80e7fbd6803c8adb/18e0ad47009f48e197ca0abd7f70cf03.html",children:"SAP Help"})," for details."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Server Group:"})," Recommended to assign to one application server only."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Schedule MQTT Job for Asynchronous Events"}),"\nIf a daemon is unavailable, schedule a job for report ",(0,t.jsx)(n.code,{children:"/UBC/MQTT_SIMPLE_WS_CLIENT"})," in ",(0,t.jsx)(n.code,{children:"SM36"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"handler-implementation-inbound",children:"Handler Implementation (Inbound)"}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"#handler",children:"Handler"}),". Specify topics for proxy type ",(0,t.jsx)(n.code,{children:"MB"})," (MQTT Broker, Simple)."]}),"\n",(0,t.jsx)(n.h3,{id:"publish-message-outbound",children:"Publish Message (Outbound)"}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Supported only for daemons, which must be running."})}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-abap",children:"/ubc/cl_daemon_mqtt_simple=>factory( )->publish(\n  is_proxy_key = value #( organization_id = 'YourBrokerOrgId' )\n  io_packet    = /ubc/cl_mqtt_packet_publish=>factory(\n                     )->set_qos_level( /ubc/if_mqtt_packet=>mc_qos-at_least_once\n                     )->set_message( value #( topic = /ubc/cl_mqtt_topic=>factory( 'SAP/1' )\n                                              message = cl_binary_convert=>string_to_xstring_utf8( 'test' ) ) ) ).\n"})}),"\n",(0,t.jsx)(n.h2,{id:"custom-implementation",children:"Custom Implementation"}),"\n",(0,t.jsxs)(n.p,{children:["For proxies that require brokers behind them, implement a custom proxy class inheriting from ",(0,t.jsx)(n.code,{children:"/UBC/CL_PROXY"})," and override ",(0,t.jsx)(n.code,{children:"CREATE_MQTT_CLIENT_CONFIG"})," to return ",(0,t.jsx)(n.code,{children:"/UBC/IF_MQTT_CLIENT_CONFIG"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Example:"})," ",(0,t.jsx)(n.code,{children:"/UBC/CL_S17_PROXY"})]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>o,x:()=>l});var s=i(96540);const t={},r=s.createContext(t);function o(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),s.createElement(r.Provider,{value:n},e.children)}},58913:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/image_002-ca6a9820e8a19102d97bac8062d87801.png"}}]);